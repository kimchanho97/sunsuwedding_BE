# 순수웨딩 2.0

![순수웨딩 소개](https://github.com/Step3-kakao-tech-campus/Team5_BE/assets/84652886/ebb9b772-69cd-413d-9d17-cb10fefdf714)

### 목차

1. [프로젝트 소개](#-프로젝트-소개)
2. [개발 주안점](#%EF%B8%8F개발-주안점)
3. [애플리케이션 모듈 구성 및 패키지 구조](#-애플리케이션-모듈-구성-및-패키지-구조)
4. [시스템 구성도](#%EF%B8%8F-시스템-구성도)
5. [운영 인프라 환경](#%EF%B8%8F-운영-인프라-환경)
6. [기능 시연](#-기능-시연)

<br>

## 🚀 프로젝트 소개

**순수웨딩 2.0**은 예비 부부와 웨딩 플래너를 **투명한 가격과 실시간 상담을 통해 연결**하는 웨딩 매칭 플랫폼입니다.

이 프로젝트는 기존 **순수웨딩 1.0 팀 프로젝트**를 기반으로,  
**기획부터 프론트엔드, 백엔드, 인프라까지 모든 영역을 1인 풀스택으로 리팩토링 및 재구현**한 개인 프로젝트입니다.

<br>

### 🎯 Why 순수웨딩?

결혼 준비를 시작하면 누구나 느끼는 불편함이 있습니다.

- 💸 **불투명한 가격 정보**: 지인 소개로만 저렴한 견적을 받을 수 있는 구조
- 📑 **복잡한 정보 탐색 과정**: 웨딩 박람회, 블로그, SNS를 모두 뒤져야 하는 번거로움
- 🤝 **판매자 중심 시장**: 소비자가 아닌 판매자가 주도하는 구조
- 💼 **웨딩 플래너의 열정페이**: 경력 중심 수익 구조와 낮은 초봉

**👉 순수웨딩은 가격 공개, 실시간 상담, 리뷰 중심 매칭 기능을 통해 소비자가 주도하는 새로운 결혼 준비 경험을 제공합니다.**

<br>

### 💡 주요 기능

- 🤵🏻‍♀️ **플래너 포트폴리오 열람**

    - 플래너 자기소개, 예상 견적, 시공 사진, 리뷰 등 확인
    - 멤버십 가입 시 실제 계약 이력(업체명, 가격, 날짜 등) 열람 가능

- 💬 **실시간 채팅 상담**

    - 원하는 플래너와 1:1 채팅 상담
    - 견적 협의 및 계약 여부는 자유롭게 결정

- 🧾 **견적서 공유**

    - 견적서 작성 및 수정 기능
    - 업체명, 가격, 진행 상태 등을 명확히 공유
    - 견적 확정 후 리뷰 작성 가능

- ⭐ **리뷰 및 찜하기**

    - 계약 완료 후 작성된 실제 후기 열람
    - 플래너 찜 기능으로 관심 플래너 저장

<br>

### 🗓 개발 기간

2025.03 ~ 2025.04

<br>

### 🔗 링크 모음

- **서비스 배포 주소**: `https://sunsu-wedding.shop` (서비스 중단)
- **프론트엔드 레포지토리**: [순수웨딩 프론트엔드 레포지토리 바로가기](https://github.com/kimchanho97/sunsuwedding_FE)
- **채팅 서버 레포지토리**: [순수웨딩 채팅 서버 레포지토리 바로가기](https://github.com/kimchanho97/sunsuwedding_CHAT)
- **프로젝트 문서(Notion)**: [순수웨딩 2.0 프로젝트 문서 바로가기](https://kimchanho.notion.site/2-0-1a0a1b1b0041809f8f31fa9314b10a34)

> **현재 서비스는 비용 절약을 위해 중단된 상태입니다.**  
> **프로젝트의 모든 상세 내용은 아래 문서에서 확인할 수 있습니다.**

<br>

## 🛠️개발 주안점

### 📌 결제 시스템 아키텍처: 보안 강화 및 데이터 일관성 보장

클라이언트 주도 결제 프로세스의 두 가지 핵심 문제를 해결했습니다:

- **보안 취약점**: 클라이언트에서 결제 금액과 주문 ID 위변조 가능성
- **데이터 불일치**: 외부 결제 승인과 내부 상태 업데이트 간 정합성 결여

**개선된 아키텍처:**
- 결제 요청 데이터를 **서버에 사전 저장**하여 요청값 검증
- 외부 결제 API와 내부 DB 업데이트를 **논리적으로 통합 관리**
- 내부 상태 업데이트(결제 기록, 등급 변경)를 **단일 트랜잭션으로 처리**

이를 통해 결제 데이터 **위변조를 원천 차단**하고, **외부 시스템과의 정합성을 보장**하는 견고한 결제 시스템을 구축했습니다.

📂 [결제 시스템 상세 설계 문서](https://kimchanho.notion.site/PG-1c7a1b1b004180f1b65ffaaadd572f4a)

<br>

### 📌 분산 환경에서의 결제 처리 일관성 보장 아키텍처

> **핵심 요약**: 외부 결제 시스템과 내부 DB 간 **상태 불일치 문제를 해결**하기 위해, Toss를 **SSOT(Single Source of Truth)로 설정**하고 **복구 가능한 실패 처리 메커니즘**을 구현했습니다.

#### 🔍 문제 상황

분산 환경에서 결제 처리 시 다음과 같은 일관성 문제가 발생할 수 있습니다:

<img width="600" alt="결제 처리 분산 환경 구조" src="https://github.com/user-attachments/assets/7e6a9538-19fe-46d6-aa86-e3b812751bb2" />

| 시나리오 | 결과 | 비즈니스 영향 |
|:-----|:-----|:------|
| Toss 결제 완료 → 네트워크 유실 | 외부(Toss): 결제 완료<br>내부(DB): 미반영 | **사용자는 결제했으나<br>서비스는 미결제로 인식** |
| Toss 결제 완료 → DB 커밋 실패 | 외부(Toss): 결제 완료<br>내부(DB): 미반영 | **사용자 등급 업그레이드 안됨** |

#### ✅ 해결 방안

1. **트랜잭션 분리**
  - Toss API 호출은 **트랜잭션 외부**에서 수행
  - 내부 상태 업데이트(결제 기록, 등급 변경)는 **단일 트랜잭션으로 처리**

2. **복구 메커니즘 구현**
  - 실패 시 로그 자동 기록
  - Toss를 **SSOT**로 활용
  - **복구 채널 다중화**: Webhook / 상태 조회 API / 배치 처리

이 접근법은 **완전한 원자성 대신 일관성 있는 복구를 보장**하는 방식으로, 사용자 경험을 해치지 않으면서 **분산 시스템의 한계를 극복**합니다.

📂 [분산 환경 결제 처리 상세 설계 문서](https://kimchanho.notion.site/1cda1b1b004180a183c8dda1976e23b9)

<br>

### 📌 외부 결제 API 추상화로 테스트 용이성 확보

Toss Payments API와 비즈니스 로직을 **인터페이스로 분리**하여 테스트 가능한 구조를 설계했습니다.

- 서비스 레이어는 `PaymentApprovalClient` **인터페이스에만 의존**
- 실제 외부 API 호출은 `TossPaymentApprovalClient` **구현체에 격리**
- 단위 테스트에서 **Mock 객체로 대체 가능** → 외부 API 의존성 없는 테스트
- 다른 결제 시스템 추가 시 새 구현체만 개발 → **확장성 확보**

**객체지향 설계 원칙**을 실제 결제 시스템에 적용하여 **변경에 유연한 구조**를 구현했습니다.

<br>

### 📌 포트폴리오 목록 조회 API - 성능 최적화

메인 화면의 핵심인 **포트폴리오 목록 조회 API의 성능을 2.4배 향상**시켰습니다.

- **DTO Projection**: 불필요한 엔티티 조회 제거
- **커서 기반 페이지네이션**: 오프셋 기반 페이징의 성능 한계 극복
- **Redis 캐싱**: 반복 조회되는 데이터 메모리 캐싱
- **Connection/Thread Pool 튜닝**: 서버 리소스 최적 활용

**📊 성능 개선 결과**
- **최대 처리량: 626 → 1,500 TPS (2.4배 향상)**
- **CPU 사용률: 87% → 57% (30%p 감소)**
- **평균 응답시간: 15ms → 8ms (47% 단축)**

이를 통해 **트래픽 급증 상황에서도 안정적인 서비스 운영이 가능**해졌습니다.

📂 [성능 테스트 설계 및 시나리오 문서](https://kimchanho.notion.site/API-1c8a1b1b0041809ba00cd1f263ee6a8a)  
📂 [단계별 API 성능 개선 결과 문서](https://kimchanho.notion.site/API-1c7a1b1b004180e5a6a9e7b61ceec67e)

<br>

### 📌 정적 캐싱 + 동적 개인화 처리로 캐시 효율 극대화

<b>포트폴리오 목록(자주 변경되지 않음)</b>과 <b>찜 상태(사용자별로 다름)</b>의 특성 차이를 활용해 캐싱 효율을 극대화했습니다.

- **비로그인 사용자**: 캐시된 데이터 그대로 응답 (즉시 반환)
- **로그인 사용자**: 캐시 데이터 + 찜 상태 개인화 처리 (DB I/O 최소화)

```java
// 캐시에서 기본 데이터 조회
if (cached != null) {
    if (userId == null) {
        return cached; // 비로그인 사용자는 그대로 반환
    }
    // 로그인 사용자는 찜 상태만 동적으로 개인화 처리
    return new CursorPaginationResponse<>(
        personalizeFavoriteStatus(cached.getData(), userId), 
        cached.getNextCursor()
    );
}
```

<br>

### 📌 커버링 인덱스로 반복 호출 쿼리 성능 3배 향상

찜한 포트폴리오 ID 목록 조회는 **여러 주요 API에서 페이지네이션마다 반복 호출되는 핵심 쿼리**입니다.  
현재 병목은 아니지만 호출 빈도가 높아 트래픽 증가 시 영향이 커질 수 있어, 선제적 최적화를 진행했습니다.

- **최소한의 코드 변경**: `IN 절 + CaseBuilder` 구조를 유지하며 복잡한 조인 없이 구현
- **커버링 인덱스 적용**: `(user_id, portfolio_id)` 복합 인덱스로 디스크 접근 없이 빠른 조회
- **성능 개선 효과**: 평균 쿼리 시간 **2.215ms → 0.775ms (약 65% 단축, 3배 성능 향상)**  
  → 실제 50만 건 데이터셋 기준, nanoTime 측정 결과

이러한 **인덱스 기반 최적화로 충분한 성능을 확보**한 후, 추후 트래픽 증가 시 필요하다면
구조적 개선(JOIN 방식 등)으로 확장할 수 있는 유연한 기반을 마련했습니다.

📂 [커버링 인덱스 최적화 및 성능 분석 문서](https://kimchanho.notion.site/3-1caa1b1b00418006806fe5be70cf4bcc)

<br>

### 📌 Redis 기반 배치 처리로 고빈도 쓰기 작업 최적화

`찜하기(Favorite)` 기능은 빈번한 쓰기 작업이 발생하는 영역으로, 트래픽 증가 시 DB 성능 병목을 방지하기 위해
Redis와 배치 처리를 활용한 최적화를 구현했습니다.

- **Redis 기반 지연 처리**: Set 구조를 활용해 찜 등록/취소 요청을 임시 저장
- **효율적인 배치 처리**: 5분 단위 스케줄러로 JDBC 기반 대량 반영
- **최적화된 키 구조**: 사용자 요청(Set)과 변경된 유저 목록(Set)을 분리 저장하여 **배치 처리 시 전체 키 탐색 없이 유저 단위로 빠르게 처리 가능**
- **상태 일관성 확보**: `(DB 상태 + Redis 추가 요청 - Redis 삭제 요청)` 연산으로 항상 최신 상태 반환

이를 통해 **DB 쓰기 부하를 크게 줄이면서도** 사용자에게 항상 일관된 최신 상태를 제공할 수 있었습니다.

<br>

## 🧩 애플리케이션 모듈 구성 및 패키지 구조

### 📊 시스템 모듈 다이어그램

<img alt="Image" src="https://github.com/user-attachments/assets/e564b30e-77db-4206-af46-64de46b4580b" />

### 📁 프로젝트 폴더 구조

```
├───📂common                    # 공통 유틸, 예외, 공통 응답 객체 등
│   ├───📂entity                # BaseEntity, BaseTimeEntity 등 공통 엔티티 정의
│   ├───📂exception             # 전역 예외 및 ErrorCode 관리
│   ├───📂response              # ApiResponse, ErrorResponse 등 공통 응답 포맷
│   └───📂util                  # 공통 유틸리티 클래스
├───📂domain                    # 도메인 중심 구조 (수직 계층 구성)
│   ├───📁auth                  
│   ├───📁chat                  
│   ├───📁favorite              
│   ├───📁payment               
│   ├───📁portfolio             
│   └───📁user                  
│       ├───📁controller        # API 진입 지점
│       ├───📁service           # 도메인 서비스 (유즈케이스 처리)
│       ├───📁repository        # DB 접근 로직
│       └───📁exception         # 도메인 전용 예외
└───📂infra                     # 외부 시스템 및 기술 인프라 구성
    ├───📂config                # Spring 설정 클래스 (Redis, S3, Security 등)
    ├───📂redis                 # Redis 설정 및 캐시 전략
    ├───📂security              # Security 필터 등 보안 설정
    └───📂storage               # AWS S3 등 외부 저장소 연동
```

<br>

## 🏗️ 시스템 구성도

<img alt="Image" src="https://github.com/user-attachments/assets/74539432-4829-4d14-82c5-ca1f37e83c37" />

<br>
<br>

## ☁️ 운영 인프라 환경

순수웨딩 백엔드는 **AWS 기반의 실서버 환경에서 운영**되며,  
각 기능별로 **책임이 분리된 최소 구성 인프라**를 활용해 전체 시스템을 안정적으로 구성하였습니다.

| 구성 요소              | 인프라 유형                         | 설명                                         |
|--------------------|--------------------------------|--------------------------------------------|
| **WAS 서버**         | EC2 (`t2.micro`)               | Spring Boot 애플리케이션 구동, Redis & Nginx 운영    |
| **채팅 서버**          | EC2 (`t2.micro`)               | WebSocket 기반 실시간 채팅 서비스 구동                 |
| **DB 서버**          | RDS (MySQL, `db.t4g.micro`)    | 프로덕션 데이터베이스 운영                             |
| **Object Storage** | S3                             | 사용자 이미지, 에셋 등 정적 파일 저장소                    |
| **정적 프론트 호스팅**     | S3 + CloudFront + ACM          | React 정적 파일을 S3에 배포하고, CloudFront로 전송 최적화  |
| **DNS 관리**         | Route 53                       | 백엔드/프론트 도메인 연결 및 SSL 인증 설정                 |
| **모니터링 서버**        | Azure VM (`Standard B2ats v2`) | Prometheus + Grafana 운영, 시스템 성능 모니터링 전용 서버 |
| **CI/CD 파이프라인**    | GitHub Actions + Docker Hub    | 빌드 자동화 및 컨테이너 배포 관리                        |

> **💡 전체 인프라는 AWS를 기반으로 구성하되,  
> 모니터링 서버는 비용 효율성과 리소스 분산을 고려해 Azure 환경에 별도 구축하였습니다.**

<br>

## 🎥 기능 시연

|                                                             포트폴리오 탐색                                                              |                                                             검색 및 필터링                                                              |
|:---------------------------------------------------------------------------------------------------------------------------------:|:---------------------------------------------------------------------------------------------------------------------------------:|
| <img width="380" src="https://github.com/Step3-kakao-tech-campus/Team5_FE/assets/104095041/18e4e9cc-87ed-4053-bec3-fd25e48fda29"> | <img width="380" src="https://github.com/Step3-kakao-tech-campus/Team5_FE/assets/104095041/a52c056e-9912-4062-b926-b1c64eb78eb9"> |
|                             • 플래너 소개, 포트폴리오 이미지, 리뷰 확인 <br> • 멤버십 가입 시 실제 계약 이력(가격, 업체 등) 열람 가능 <br>                              |                                              • 지역, 가격 등 조건 설정 <br> • 플래너 이름 검색 기능 지원                                              |

|                                                      메시지 & 이미지 전송                                                      |                                                             채팅 응답 기능                                                              |
|:----------------------------------------------------------------------------------------------------------------------:|:---------------------------------------------------------------------------------------------------------------------------------:|
| <img width="380" src="https://github.com/kimchanho97/algorithm/assets/104095041/d3b0faf7-d20c-4e83-9d66-00d2c38253c6"> | <img width="380" src="https://github.com/Step3-kakao-tech-campus/Team5_FE/assets/104095041/0863820b-a151-4551-8c01-c8478e3a49ad"> |
|                                         • 텍스트 및 이미지 전송 가능 <br> • 실시간 채팅 상담 제공                                          |                                           • 메시지 읽음 표시 <br> • 안 읽은 메시지 개수 표시로 사용자 편의성 강화                                           |

|                                                           포트폴리오 작성 / 수정                                                           |                                                            견적서 작성 / 수정                                                            |
|:---------------------------------------------------------------------------------------------------------------------------------:|:---------------------------------------------------------------------------------------------------------------------------------:|
| <img width="380" src="https://github.com/Step3-kakao-tech-campus/Team5_FE/assets/104095041/2474a94c-6a19-4e02-b047-500b80b307a6"> | <img width="380" src="https://github.com/Step3-kakao-tech-campus/Team5_FE/assets/104095041/7c2c1e74-4bb1-4682-b26f-51fb07015f1a"> |
|                                    • 플래너 자기소개, 예상 가격 등 정보 등록 및 수정 <br> • 이미지 업로드 및 포트폴리오 삭제 가능                                    |                                     • 채팅 내 견적서 작성 및 수정 가능 <br> • 업체명, 가격, 진행 상태 등 명확하게 기록 가능                                      |

|                                                            리뷰 작성 / 수정                                                             |                                                               리뷰 조회                                                               |
|:---------------------------------------------------------------------------------------------------------------------------------:|:---------------------------------------------------------------------------------------------------------------------------------:|
| <img width="380" src="https://github.com/Step3-kakao-tech-campus/Team5_FE/assets/104095041/aed20cd4-a50d-4084-ba63-99c00e160de7"> | <img width="380" src="https://github.com/Step3-kakao-tech-campus/Team5_FE/assets/104095041/4997bb5f-aa6e-47d5-a60c-aea1d166f75c"> |
|                                           • 별점 및 후기를 작성, 수정, 삭제 가능 <br> • 실제 계약 후 작성 가능                                           |                                                          • 플래너별 리뷰 확인 가능                                                          |

|                                                                결제                                                                 |                                                                찜하기                                                                |
|:---------------------------------------------------------------------------------------------------------------------------------:|:---------------------------------------------------------------------------------------------------------------------------------:|
| <img width="380" src="https://github.com/Step3-kakao-tech-campus/Team5_FE/assets/104095041/1a03508c-5e5a-43c1-a367-3a8a82f92dcb"> | <img width="380" src="https://github.com/Step3-kakao-tech-campus/Team5_FE/assets/104095041/452e1f91-7115-46f2-83de-7e0e007fce99"> |
|                                           • Toss Payments 연동 <br> • 결제 완료 시 유저 등급 업그레이드                                           |                                       • 관심 플래너를 찜하기 등록/해제 가능 <br> • 마이페이지에서 찜한 플래너 목록 조회 가능                                       |

<br>